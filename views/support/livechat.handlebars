<div class="d-flex justify-content-center" style="height: calc(70vh); ">
    <div class="shadow-sm d-flex flex-column rounded border col-10" style="height:100%;">
        <div class="p-3 overflow-auto" style="height:100%;">
            <div class="flex-grow-1 overflow-auto" id="chat-panel">

            </div>
        </div>
        <div class="border-top">
            <div class="message-box p-3">
                <div id="chat-box">
                    <form id="chat-form" class="d-flex">
                        <input id="msg" class="flex-grow-1 form-control" type="text" placeholder="Enter Message"
                            required autocomplete="off" />
                        <button type="submit" class="btn">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script defer>
    $(document).ready(function () {

        var targetId = window.location.href.split('/')
        targetId = targetId[targetId.length - 1]

        if (targetId) {
            socket.auth = { id:targetId }
            socket.connect()
        }

        var d = $('#chat-panel');
        function msgFormater(owner, content) {
            var options = new Array()
            if (owner) {
                options.push('right')
                options.push('justify-content-end')
            } else {
                options.push('left')
                options.push('')
            }
            const msgFormat = [
                `<div class="d-flex ${options.pop()}">`,
                `<div class="chat-bubble chat-bubble--${options.pop()} text-break" style="max-width: 50%;">`,
                `${content}`,
                `</div>`,
                `</div>`,
            ]

            return msgFormat.join('')
        }

        socket.on('livechat:receive', (data) => {
            console.log("msg recieved")
            var owner = data.owner == targetId
            $('#chat-panel').append(msgFormater(owner, data.msg))
            d.scrollTop(d.prop("scrollHeight"));
        })

        socket.on('livechat:inside', ({ name, id }) => {
            $('#chat-panel').append(msgFormater(false, `${name} has joined the chat`))
            let x = true
            socket.emit('livechat:acknowledgement', { id, x })
        })

        $('#chat-form').on('submit', function (e) {
            e.preventDefault();
            // Get message text
            let msg = e.target.elements.msg.value;

            msg = msg.trim();

            if (!msg) {
                return false;
            }

            // Emit message to server
            socket.emit('livechat:sent', { id:targetId, msg, owner: targetId });

            // Clear input
            e.target.elements.msg.value = '';
            e.target.elements.msg.focus();

        });
    })
</script>