INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 2, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-29 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-29 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-29 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-29 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-30 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 5, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-31 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-31 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-07-31 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-1 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-1 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-1 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-1 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-3 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-3 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 3, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-7 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-3 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-3 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-3 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-4 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-4 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-5 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-6 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-7 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 7, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-5 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-6 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-7 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-9 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-10 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-11 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-12 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 1, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-13 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 2, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-13 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 2, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-14 16:22:30","2022-07-28 16:22:30",9);
INSERT into orderitems (productSku, qtyPurchased, product_name, product_price, seller_name, seller_id, posterURL, review,seller_cut,tit_cut, orderStatus, createdAt, updatedAt, orderId) VALUES (660585572, 2, "White Blouse", 123, "Classy Jack", 3,"/uploads/3/3-1660585529761.jpg",0,100,23, "Processing", "2022-08-15 16:22:30","2022-07-28 16:22:30",9);
@app.route('/my-requests/cart/checkout')
@login_required
def redirect_to_checkout():
    return render_template('customer/checkout.html')

@app.route('/my-requests/cart/checkout/new')
@login_required
def create_checkout_session():
    domain_url = "https://127.0.0.1:5000/my-requests/cart/checkout/"
    stripe.api_key = stripe_keys["secret_key"]
    try:
        checkout_session = stripe.checkout.Session.create(
            success_url=domain_url + "success?session_id={CHECKOUT_SESSION_ID}",
            cancel_url=domain_url + "cancelled",
            payment_method_types=["card"],
            mode="payment",
            line_items=[
                {
                    "name": "Flat Fee",
                    "quantity": 1,
                    "currency": "sgd",
                    "amount": "30000",
                }
            ]
        )
        return jsonify({"sessionId": checkout_session["id"]})
    except Exception as e:
        return jsonify(error=str(e)), 403

@app.route('/my-requests/cart/checkout/success')
@login_required
def checkout_success():
    flash(f"Your payment is successful!", "success")
    return redirect(url_for('customerRequest'))

@app.route('/my-requests/cart/checkout/cancelled')
@login_required
def checkout_cancelled():
    request = Request.query.filter_by(owner=current_user).order_by(Request.creation_datetime.desc()).first()
    db.session.delete(request)
    db.session.commit()
    flash(f"Your payment has been cancelled!", "danger")
    return redirect(url_for('customerCart'))